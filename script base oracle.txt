-- Création des séquences

CREATE SEQUENCE SeqVisiteur
START WITH 1 MAXVALUE 10000;

CREATE SEQUENCE SeqDelegue
START WITH 1 MAXVALUE 10000;

CREATE SEQUENCE SeqRDV
START WITH 1 MAXVALUE 10000;

CREATE SEQUENCE SeqRapport
START WITH 1 MAXVALUE 10000;

CREATE SEQUENCE SeqMedicament
START WITH 1 MAXVALUE 10000;

CREATE SEQUENCE SeqPraticien
START WITH 1 MAXVALUE 10000;


-- Création des tables

CREATE TABLE VISITEUR ( 
	ID INT NOT NULL,
	PRENOM_VISITEUR VARCHAR(30) NOT NULL,
	NOM_VISITEUR VARCHAR(30) NOT NULL,
	HIERARCHIE CHAR DEFAULT NULL,
	MDP VARCHAR(20) NOT NULL,
	CONSTRAINT PK_VISITEUR PRIMARY KEY (ID)
	);

CREATE TABLE DELEGUE (
	ID_DELEGUE INT NOT NULL,
	CONSTRAINT PK_DELEGUE PRIMARY KEY (ID_DELEGUE)
	);

CREATE TABLE RENDEZ_VOUS (
	ID INT NOT NULL,
	DATE_RDV DATE NOT NULL,
    ID_VISITEUR INT NOT NULL,
    ID_PRATICIEN INT NOT NULL,
	CONSTRAINT PK_RENDEZ_VOUS PRIMARY KEY (ID)
	);

CREATE TABLE PRATICIEN (
	NUM_RPPS INT NOT NULL,
	NOM_PRATICIEN VARCHAR(30) NOT NULL,
	PRENOM_PRATICIEN VARCHAR(30) NOT NULL,
	ADRESSE_PRATICIEN VARCHAR(100),
	CONSTRAINT PK_PRATICIEN PRIMARY KEY (NUM_RPPS)
	);

CREATE TABLE RAPPORT (
	ID INT NOT NULL,
	RAPPORT_VISITE VARCHAR(255) NOT NULL,
	DATE_VISITE DATE NOT NULL,
    	ID_VISITEUR INT NOT NULL,
    	ID_PRATICIEN INT NOT NULL,
	CONSTRAINT PK_RAPPORT PRIMARY KEY (ID)
	);

CREATE TABLE MEDICAMENT (
	CODE_MEDICAMENT INT NOT NULL,
	LIBELLE_MEDICAMENT VARCHAR(50) NOT NULL,
	CONSTRAINT PK_MEDICAMENT PRIMARY KEY (CODE_MEDICAMENT)
	);

CREATE TABLE OFFRIR (
	ID_RAPPORT INT NOT NULL,
	CODE_MEDICAMENT INT NOT NULL,
	CONSTRAINT PK_OFFRIR PRIMARY KEY (ID_RAPPORT, CODE_MEDICAMENT)
	);

CREATE TABLE QUANTITE(
	ID_RAPPORT INT NOT NULL,
	CODE_MEDICAMENT INT NOT NULL,
	QUANTITE INT NOT NULL,
	CONSTRAINT PK_QUANTITE PRIMARY KEY (ID_RAPPORT, CODE_MEDICAMENT)
	);

ALTER TABLE QUANTITE
	ADD CONSTRAINT FK_QUANTITE_RAPPORT
	FOREIGN KEY (ID_RAPPORT) REFERENCES RAPPORT(ID);

ALTER TABLE QUANTITE
	ADD CONSTRAINT FK_QUANTITE_MEDICAMENT
	FOREIGN KEY (CODE_MEDICAMENT) REFERENCES MEDICAMENT(CODE_MEDICAMENT);

ALTER TABLE RENDEZ_VOUS
	ADD CONSTRAINT FK_VISITEUR_RDV
	FOREIGN KEY (ID_VISITEUR) REFERENCES VISITEUR(ID);

ALTER TABLE RENDEZ_VOUS
	ADD CONSTRAINT FK_PRATICIEN_RDV
	FOREIGN KEY (ID_PRATICIEN) REFERENCES PRATICIEN(NUM_RPPS);

ALTER TABLE RAPPORT
	ADD CONSTRAINT FK_VISITEUR_RAPPORT
	FOREIGN KEY (ID_VISITEUR) REFERENCES VISITEUR(ID);

ALTER TABLE RAPPORT
ADD CONSTRAINT FK_PRATICIEN_RAPPORT
FOREIGN KEY (ID_PRATICIEN) REFERENCES PRATICIEN(NUM_RPPS);


-- Insertion du visiteur :

INSERT INTO VISITEUR(id, PRENOM_VISITEUR, NOM_VISITEUR, MDP)
VALUES (
	SeqVisiteur.NEXTVAL ,
	'Billy',
	'Bob',
	'Iroise27'
);

INSERT INTO VISITEUR(id, PRENOM_VISITEUR, NOM_VISITEUR, MDP)
VALUES (
	SeqVisiteur.NEXTVAL ,
	'Roger',
	'Corre',
	'Iroise28'
);

INSERT INTO VISITEUR(id, PRENOM_VISITEUR, NOM_VISITEUR, MDP)
VALUES (
	SeqVisiteur.NEXTVAL ,
	'Claire',
	'Dertier',
	'Iroise29'
);

-- Insertion des praticiens :

INSERT INTO praticien (num_rpps,NOM_PRATICIEN,PRENOM_PRATICIEN,ADRESSE_PRATICIEN)
VALUES (
	SEQPRATICIEN.nextval,
	'Billy',
	'Bob',
	'20 rue des potiers'
);

INSERT INTO praticien (num_rpps,NOM_PRATICIEN,PRENOM_PRATICIEN,ADRESSE_PRATICIEN)
VALUES (
	SEQPRATICIEN.nextval,
	'Grégoire',
	'Calavec',
	'20 rue des potiers'
);

-- Insertion des médicaments :

INSERT INTO medicament (code_medicament,libelle_medicament)
VALUES (
	SEQMEDICAMENT.nextval,
	'Dafalgan'
);

INSERT INTO medicament (code_medicament,libelle_medicament)
VALUES (
	SEQMEDICAMENT.nextval,
	'Ventoline'
);

INSERT INTO medicament (code_medicament,libelle_medicament)
VALUES (
	SEQMEDICAMENT.nextval,
	'Tramadol'
);

INSERT INTO medicament (code_medicament,libelle_medicament)
VALUES (
	SEQMEDICAMENT.nextval,
	'Doliprane'
);
INSERT INTO medicament (code_medicament,libelle_medicament)
VALUES (
	SEQMEDICAMENT.nextval,
	'Aerius'
);